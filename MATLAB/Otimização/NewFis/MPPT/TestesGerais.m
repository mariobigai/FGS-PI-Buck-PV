clc
clear
tic
% Parameters --------------------------------------------------------
parameters.populationSize = 50;

parameters.chromosomeLength = 85;

parameters.maxGenerations = 100;

parameters.mutationRate = 0.03;

parameters.crossoverRate = 0.35;

parameters.Restr = [[0 10] [0 2] [-1 1] [-7 7] [0 1]];

parameters.tournamentSize = 17;

parameters.criterion = 0;%criterio para maximizar (1) ou para minimizar (0) a função objetivo

parameters.k = 1;%parametro para printar no commandWindow os K's melhores de cada geração

parameters.runsNumber = 10;

parameters.fitnessRef = 0.144986;

% parameters.fitnessRef = 0.5696;% (valor de fitness com média movel e IAE's separadas)
% parameters.fitnessRef = 0.1632; %(valor de fitness com média movel e só IAE. Serve para o metodo 2)
%1.5982(valor de fitness sem média movel)

parameters.countmax = 10;% define o numero de vezes que o fitness de referencia deve ser superado



%Adiciona o caminho dos otimizadores --------------------------------------------------------
addpath('C:\Users\UTFPR\Desktop\Mario\Otimização\NewFis\MPPT\Ga')

%Carrega o sistema --------------------------------------------------------
load_system('buck_pv_otm_MPPT.slx');
warning('off','all')

ini_ind = [[1/3 1]  ...% Ganhos de fuzificação ke kde - [0 ... 10]
      [0.00013 0.036] ... % Ganhos de defuzificação kkp kki - [0 ... 1]
      [0.4 1 0.6 0 0.8 0.2 -0.4 0.1] ... % Pontos MF entrada E - [-1 ... 1]
      [0.4 1 0.6 0 0.8 0.2 -0.4 0.1]  ...% Pontos MF entrada dE -[-1 ... 1]
      [0.4 1 0.6 0 0.8 0.2 -0.4 0.1]  ...% Pontos MF saída kp [-1 ... 1]
      [0.4 1 0.6 0 0.8 0.2 -0.4 0.1]  ...% Pontos MF saída ki [-1 ... 1]
      [7 4 7 4 6 7 6 6 5 6 5 4 4 4 7 7 7 7 6 6 6 6 5 5 4 4 4 4 6 6 6 6 6 5 5 4 5 5 3 3 2 2 6 6 3 3 4 4 4 4 4 4 3 3 2 2 6 6 5 5 3 3 3 4 2 3 2 2 2 2 4 4 4 4 3 3 2 2 2 2 1 1 1 1 4 4 3 4 3 2 2 2 2 1 1 4 1 4] ...
      [1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1]]; % Peso das Regras - [0 ... 1]


% ini_ind = [1.221633 0.151148 0.000256 0.242799 -0.000917 0.369529 0.088998 -0.000000 0.696766 0.173499 -0.769645 0.021460 0.168826 1.000000 0.209635 0.000000 0.799520 0.162112 -0.602056 0.002209 0.000180 1.000000 0.023932 0.000000 0.899958 0.006590 -0.376983 0.178424 0.594244 1.000000 0.333143 -0.000000 0.946112 0.637341 -0.849230 0.003101 0.004006 -5.704342 7.000000 0.012786 0.172239 7.000000 -0.273675 6.354470 1.038646 0.009272 -1.185319 -0.002519 -1.211380 0.018773 0.802882 0.213132 0.761299 0.183474 -4.978139 0.455112 6.769718 -0.094279 -2.120101 -0.321207 0.371006 3.876132 -0.283141 6.502171 -0.856488 -0.251016 -0.127571 1.843381 0.016352 5.892562 1.268543 4.000000 6.998968 6.137750 1.031058 -1.157875 0.028276 -2.962826 3.798838 -4.595664 1.402764 5.923525 -1.039033 0.006064 -2.222892 4.000000 1.784162 -5.428473 0.920831 -1.067475 -0.018766 2.856010 1.957571 5.449175 0.000213 -3.121832 1.337957 0.014174 -1.104995 -1.984383 -0.001233 0.873043 4.177858 -0.100526 -0.000274 -2.400747 -1.841326 -5.364607 -0.151028 0.655109 3.632078 1.013325 -1.283234 -1.408606 3.294611 0.070897 0.545499 -0.025203 -5.563909 -2.196173 0.993245 5.284705 -4.090030 6.827283 -2.400305 -0.199021 0.298094 -1.617795 2.318138 0.090376 0.702981 -1.122405 0.020071 5.786947 0.113860 0.628856 1.000000 0.218922 1.000000 1.000000 0.333670 0.065484 0.523862 0.145891 0.331110 0.281245 0.002719 1.000000 0.719810 0.381686 1.000000 1.000000 0.919067 0.083770 1.000000 0.253306 0.412988 1.000000 1.000000 1.000000 1.000000 0.316477 0.023579 1.000000 0.863179 0.959629 0.074520 0.007719 0.821919 0.680447 0.511930 0.093442 1.000000 0.270620 0.127057 1.000000 1.000000 1.000000 1.000000 1.000000 1.000000 1.000000 1.000000];

[fitness, cont_simu] = evaluatePopulation(parameters,ini_ind)

toc